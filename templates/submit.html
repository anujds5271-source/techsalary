{% extends "base.html" %}

{% block title %}Submit Salary - TechSalary.in{% endblock %}

{% block content %}

<div class="max-w-3xl mx-auto">
    
    <!-- Page Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">Submit Your Salary</h1>
        <p class="text-gray-600">Help others by sharing your salary information anonymously</p>
    </div>

    <!-- Submission Form -->
    <div class="bg-white rounded-lg shadow-lg p-8">
        <form id="submitForm" class="space-y-6">
            
            <!-- Company Selection -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Company <span class="text-red-500">*</span>
                </label>
                <select 
                    id="company_id" 
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                    <option value="">Select Company</option>
                </select>
            </div>

            <!-- Role Selection -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Job Role <span class="text-red-500">*</span>
                </label>
                <select 
                    id="role_id" 
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                    <option value="">Select Role</option>
                </select>
            </div>

            <!-- Location Selection -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Location <span class="text-red-500">*</span>
                </label>
                <select 
                    id="location_id" 
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                    <option value="">Select Location</option>
                </select>
            </div>

            <!-- Salary Details -->
            <div class="border-t pt-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üí∞ Compensation Details</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Base Salary -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Base Salary (‚Çπ) <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="base_salary" 
                            required
                            placeholder="e.g., 2000000"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                    </div>

                    <!-- Bonus -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Annual Bonus (‚Çπ)
                        </label>
                        <input 
                            type="number" 
                            id="bonus" 
                            placeholder="e.g., 300000"
                            value="0"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                    </div>

                    <!-- Stock Options -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Stock Options (‚Çπ)
                        </label>
                        <input 
                            type="number" 
                            id="stock_options" 
                            placeholder="e.g., 200000"
                            value="0"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                    </div>

                    <!-- Total (Auto-calculated) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Total CTC (‚Çπ) <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="total_compensation" 
                            required
                            readonly
                            placeholder="Auto-calculated"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"
                        >
                    </div>
                </div>
            </div>

            <!-- Experience Details -->
            <div class="border-t pt-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üíº Experience</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Total Experience -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Total Experience (years) <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="years_of_experience" 
                            required
                            min="0"
                            placeholder="e.g., 5"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                    </div>

                    <!-- Years at Company -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Years at This Company
                        </label>
                        <input 
                            type="number" 
                            id="years_at_company" 
                            min="0"
                            placeholder="e.g., 2"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                    </div>
                </div>
            </div>

            <!-- Additional Details -->
            <div class="border-t pt-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìã Additional Info</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Employment Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Employment Type
                        </label>
                        <select 
                            id="employment_type"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                            <option value="Full-time">Full-time</option>
                            <option value="Contract">Contract</option>
                            <option value="Intern">Intern</option>
                        </select>
                    </div>

                    <!-- Remote -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Work Mode
                        </label>
                        <select 
                            id="is_remote"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                            <option value="false">On-site</option>
                            <option value="true">Remote</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="pt-6">
                <button 
                    type="submit"
                    class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 text-lg"
                >
                    ‚úÖ Submit Salary Data
                </button>
            </div>

            <!-- Success/Error Message -->
            <div id="message" class="hidden mt-4"></div>

        </form>
    </div>

    <!-- Privacy Note -->
    <div class="mt-6 text-center text-sm text-gray-600">
        <p>üîí Your submission is completely anonymous. We don't collect any personal information.</p>
    </div>

</div>

<script>
// Load Companies, Roles, Locations on page load
async function loadFormData() {
    try {
        // Load Companies
        const companiesRes = await fetch('/api/companies');
        const companies = await companiesRes.json();
        const companySelect = document.getElementById('company_id');
        companies.data.forEach(company => {
            const option = document.createElement('option');
            option.value = company.id;
            option.textContent = company.name;
            companySelect.appendChild(option);
        });

        // Load Roles
        const rolesRes = await fetch('/api/roles');
        const roles = await rolesRes.json();
        const roleSelect = document.getElementById('role_id');
        roles.data.forEach(role => {
            const option = document.createElement('option');
            option.value = role.id;
            option.textContent = role.title;
            roleSelect.appendChild(option);
        });

        // Load Locations
        const locationsRes = await fetch('/api/locations');
        const locations = await locationsRes.json();
        const locationSelect = document.getElementById('location_id');
        locations.data.forEach(location => {
            const option = document.createElement('option');
            option.value = location.id;
            option.textContent = `${location.city}, ${location.state}`;
            locationSelect.appendChild(option);
        });

    } catch (error) {
        console.error('Error loading form data:', error);
    }
}

// Auto-calculate Total Compensation
function calculateTotal() {
    const base = parseFloat(document.getElementById('base_salary').value) || 0;
    const bonus = parseFloat(document.getElementById('bonus').value) || 0;
    const stocks = parseFloat(document.getElementById('stock_options').value) || 0;
    
    const total = base + bonus + stocks;
    document.getElementById('total_compensation').value = total;
}

document.getElementById('base_salary').addEventListener('input', calculateTotal);
document.getElementById('bonus').addEventListener('input', calculateTotal);
document.getElementById('stock_options').addEventListener('input', calculateTotal);

// Form Submission
document.getElementById('submitForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        company_id: parseInt(document.getElementById('company_id').value),
        role_id: parseInt(document.getElementById('role_id').value),
        location_id: parseInt(document.getElementById('location_id').value),
        base_salary: parseFloat(document.getElementById('base_salary').value),
        bonus: parseFloat(document.getElementById('bonus').value) || 0,
        stock_options: parseFloat(document.getElementById('stock_options').value) || 0,
        total_compensation: parseFloat(document.getElementById('total_compensation').value),
        years_of_experience: parseInt(document.getElementById('years_of_experience').value),
        years_at_company: parseInt(document.getElementById('years_at_company').value) || null,
        employment_type: document.getElementById('employment_type').value,
        is_remote: document.getElementById('is_remote').value === 'true',
        currency: 'INR',
        source: 'user_submission'
    };
    
    try {
        const response = await fetch('/api/salaries/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        const messageDiv = document.getElementById('message');
        messageDiv.classList.remove('hidden');
        
        if (result.error) {
            messageDiv.className = 'bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg';
            messageDiv.textContent = `‚ùå Error: ${result.error}`;
        } else {
            messageDiv.className = 'bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg';
            messageDiv.innerHTML = `
                ‚úÖ <strong>Success!</strong> Your salary data has been submitted.<br>
                <span class="text-sm">Thank you for contributing to the community!</span>
            `;
            
            // Reset form after 2 seconds
            setTimeout(() => {
                document.getElementById('submitForm').reset();
                messageDiv.classList.add('hidden');
                window.location.href = '/';
            }, 2000);
        }
        
    } catch (error) {
        const messageDiv = document.getElementById('message');
        messageDiv.classList.remove('hidden');
        messageDiv.className = 'bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg';
        messageDiv.textContent = `‚ùå Error: ${error.message}`;
    }
});

// Load data when page loads
loadFormData();
</script>

{% endblock %}

